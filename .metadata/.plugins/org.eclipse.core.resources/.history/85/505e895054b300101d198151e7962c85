package primero;

import java.io.IOException;
import java.io.RandomAccessFile;
import java.util.InputMismatchException;
import java.util.Scanner;

public class RegistroEstudiantes {
	static Scanner sc = new Scanner(System.in);
	static boolean nombreEstudianteConfirmacion = false;
	 public static void main(String[] args) {
	        String nombreArchivo = "C:\\Users\\Tarde\\Downloads\\Estudiantes.dat";

	        try (RandomAccessFile archivo = new RandomAccessFile(nombreArchivo, "rw")) {
	        	int opcion = 0;
	        	boolean irse = false;
	        	do {
	        		System.out.println("--REGISTRO DEL ESTUDIANTE--");
	        		System.out.println("1. Escribir registro");
	        		System.out.println("2. Leer registro");
	        		System.out.println("0. Terminar");
	        		System.out.print("Opción: ");
	        		try {
	        			opcion = sc.nextInt();
	        			switch(opcion) {
		        		case 1 :
		        			System.out.println("case 1 " + nombreEstudianteConfirmacion);
		        			idEstudiante(archivo);
		        			System.out.println("case 1.2 " + nombreEstudianteConfirmacion);
		        			if(nombreEstudianteConfirmacion) {
		        				nombreEstudiante(archivo);
			        			nota(archivo);
		        			}
		        			break;
		        		case 2 :
		        			System.out.print("Dime el ID del estudiante: ");
			        		int id = sc.nextInt();
		        			mostrarInformacion(archivo,id);
		        			break;
		        		case 0 :
		        			System.exit(0);
		        			irse = true;
		        			break;
		        		default:
		        			System.out.println("Opción no valida.");
		        			System.out.println("");
		        		}
	        		}
	        		catch(InputMismatchException e) {
	        			System.out.println("Opción no valida.");
	        		}
	        	}
	        	while(opcion != 0 && !irse);
	        } 
	        catch (IOException e){
	            System.err.println("Error al acceder al archivo: " + e.getMessage());
	        }
	    }
	 
	 private static void mostrarInformacion(RandomAccessFile archivo, int idBuscar) throws IOException {
		    archivo.seek(0);

		    boolean encontrado = false;

		    while (archivo.getFilePointer() < archivo.length()) {
		    	
		        int id = archivo.readInt();

		        char[] nombreCaracteres = new char[20];
		        for (int i = 0; i < 20; i++) {
		        	nombreCaracteres[i] = archivo.readChar();
		        }
		        String nombre = new String(nombreCaracteres).trim();

		        float nota = archivo.readFloat();

		        if (id == idBuscar) {
		            System.out.println("El estudiante con ID " + id + ", de nombre " + nombre + " tiene como calificación " + nota);
		            encontrado = true;
		            System.out.print("\n");
		            break;
		        }
		    }

		    if (!encontrado) {
		        System.out.println("Registro no encontrado.");
		    }
		}
	 
	 private static void idEstudiante(RandomAccessFile archivo) throws IOException {
		    archivo.seek(0);
		    System.out.print("Dime el ID del estudiante: ");
		    int idInsertar = sc.nextInt();

		    if (archivo.length() == 0) {
		        archivo.writeInt(idInsertar);
		        nombreEstudianteConfirmacion = true;
		        return;
		    }

		    boolean idExiste = false;
		    while (archivo.getFilePointer() < archivo.length()) {
		        int id = archivo.readInt();
		        if (id == idInsertar) {
		            idExiste = true;
		            break;
		        }
		    }

		    if (idExiste) {
		        nombreEstudianteConfirmacion = false;
		        System.out.println("El ID ya está registrado");
		    } else {
		        archivo.seek(archivo.length());
		        archivo.writeInt(idInsertar);
		        nombreEstudianteConfirmacion = true;
		    }
		}
	 private static void nombreEstudiante(RandomAccessFile archivo) throws IOException {
		    sc.nextLine();
		    System.out.print("Dime el nombre del estudiante: ");
		    String nombreEstudiante = sc.nextLine();

		    StringBuilder sb = new StringBuilder(nombreEstudiante);
		    sb.setLength(20);

		    for (int i = 0; i < 20; i++) {
		        archivo.writeChar(sb.charAt(i));
		    }
		}
	 private static void nota(RandomAccessFile archivo) throws IOException {
		 System.out.print("Dime la nota del estudiante: ");
         float nota = sc.nextFloat();
         archivo.writeFloat(nota);
         System.out.print("\n");
	 }
}
